class WebReactionz{#t="https://webreactionz.com";#e={layout:"horizontal",position:"top",showReactionCounts:!0,theme:"minimal"};#s="WebReactionz";#i;#n;#o;#r;#a;#c="visible";constructor(t={}){const e=e=>t[e]??t[e.toLowerCase()];if(this.#i=e("siteId"),!this.#i)throw new Error(this.#l("No Site ID provided"));this.#n=e("noAutoFetch"),this.#o=e("baseUrl")??this.#t,this.#r=t.computePageId?.()??e("pageId")??location.pathname.split("/").findLast((t=>""!==t))?.split(".")[0]??"/",this.#a=["layout","position","prompt","showReactionCounts","domSelector","bordered","fontSizeScale","fontColor","theme"].reduce(((t,s)=>{const i=e(s);return void 0!==i&&(t[s]=["showReactionCounts","bordered"].includes(s)?!!+i:i),t}),{}),this.#h(`${this.#o}/${this.#s}.min.css`)}async#d(t=!1){return fetch(`${this.#o}/api/sites/${this.#i}/widgetDetails?page_id=${this.#r}&settings=${t?"0":"1"}`).then((t=>t.json()))}async init(){try{const t=await this.#d(this.#n);this.#a={...this.#e,...t.settings??{},...this.#a};const e=this.#a.domSelector;if(!e)throw new Error(this.#l("No DOM selector provided"));const s=document.querySelector(e);if(!s)throw new Error(this.#l("No DOM element found for selector"),e);const{reactions:i,userHasReacted:n}=t,o=Object.keys(i).map((t=>this.#E(t,i[t].count,i[t].unicode,n))),r=this.#S("div",{classes:[this.#s,this.#a.position,this.#a.layout,this.#a.theme,this.#a.bordered?"bordered":""]});if(this.#a.fontSizeScale&&(r.style.fontSize=`${this.#a.fontSizeScale}em`),this.#a.fontColor&&(r.style.fontColor=this.#a.fontColor),this.#a.prompt){const t=this.#S("div",{classes:["prompt"],innerText:this.#a.prompt});r.append(t)}const a=this.#S("div",{classes:["emojis",this.#a.layout],children:o});if(r.append(a),t.branding&&r.append(this.#T()),s.insertAdjacentElement("bottom"===this.#a.position?"beforeend":"afterbegin",r),["left","right"].includes(this.#a.position)){const t=s.getBoundingClientRect().top+document.documentElement.scrollTop,e=()=>this.#I(s,r,t);e(),window.addEventListener("resize",e);const i=()=>this.#p(r,t);i(),window.addEventListener("scroll",i)}else r.classList.add(this.#c)}catch(t){console.error(this.#l("Failed to initialise"),t)}}#p(t,e){if(document.body.scrollHeight>window.innerHeight)return window.scrollY>0?t.classList.add(this.#c):t.classList.remove(this.#c),void(window.scrollY>e?t.style.top=0:t.style.top=e-window.scrollY+"px");t.classList.add(this.#c)}#I(t,e,s){e.style.top=`${s}px`;const i=e.getBoundingClientRect().width,n=t.getBoundingClientRect();"left"===this.#a.position?e.style.left=n.left-i-10+"px":e.style.left=`${n.right+i+10}px`}#E(t,e,s,i){const n=this.#S("span",{classes:["increment"],innerText:"+1"}),o=this.#S("span",{classes:["number"],innerText:this.#a.showReactionCounts&&e?e:""}),r=this.#S("span",{classes:["reaction",i&&"disabled"],data:{type:t,title:i?"You have already reacted on this page":"React to this page?"},children:[this.#S("span",{classes:["emoji"],innerText:s}),this.#S("span",{children:[o,n]})]}),a=JSON.stringify({page_id:this.#r,type:t});return r.onclick=()=>{n.classList.remove("active"),fetch(`${this.#o}/api/sites/${this.#i}/reactions`,{method:"POST",headers:{"Content-Type":"application/json"},body:a}).then((t=>t.json())).then((t=>{t.error||(n.classList.add("active"),this.#a.showReactionCounts&&(o.innerText=+(o.innerText.split("\n")[0]?.trim()??"0")+1))}))},r}#T(){return this.#S("div",{classes:["branding"],title:`Powered by ${this.#s}`,children:[this.#S("a",{href:this.#t,target:"_blank",children:[this.#S("img",{src:`${this.#o}/logo.svg`})]})]})}#S(t,e={}){const{classes:s,dataset:i,children:n,...o}=e,r=document.createElement(t);return Object.keys(o).forEach((t=>r[t]=o[t])),n?.forEach((t=>r.appendChild(t))),s&&r.classList.add(...s.filter((t=>!!t))),Object.keys(i??{}).forEach((t=>r.dataset[t]=i[t])),r}#h(t){document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeend",`<link rel="stylesheet" href="${t}"/>`)}#l(t){return`${this.#s} ${t}`}}const t=t=>new WebReactionz(t).init();if(!+document.currentScript.dataset.noautoinit){const e=document.currentScript.dataset;"loading"!==document.readyState?t(e):document.addEventListener("DOMContentLoaded",(()=>t(e)))}
